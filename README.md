# TOC Final Project 2017

A telegram bot based on a finite state machine

It can be used to search the image or information of characters in the social game **Granblue Fantasy**.

## Setup

### Prerequisite
* Python 3

#### Install Dependency

* pygraphviz (For visualizing Finite State Machine)
    * [Setup pygraphviz on Ubuntu](http://www.jianshu.com/p/a3da7ecc5303)

### Secret Data

`TOKEN` in Chat_Bot.py **MUST** be set to proper values.
Otherwise, you might not be able to run your code.


#### Run the sever

```sh
python3 Chat_Bot.py
```

## Finite State Machine
![fsm](./State_diagram.png)

## Usage
The initial state is set to `Service`.

Every time, the program uses `getUpdates`,the API of telegram, to check whether there is a new message send by user.

If there is a new user,the program generates a new state machine for this user

To start, input `/start`,then the program will send a `one time keyboard`.

User use this keyboard to input specific message.

function `State_handler` determines the message generated by `one time keyboard`,then triggers the state and saves necessary data in the variable `information`.

Finally, `State_handler` uses `information` to generate an image or an url(depend on the service user choose), and sends it to user.

* user
	* Input: "/start"
		* Reply: "Welcome,,please choose the service"

	* Input: "Search image"(by one time keyboard)
		* Reply: "Please select element of the character"

	* Input: "Fire"(by one time keyboard)
		* Reply: "Please select character"

	* Input: "Percival"(by one time keyboard)
		* Reply: "Please select level"

	* Input: "â˜… 3"(by one time keyboard)
		* Reply: An image of the character "Percival" in the social game Granblue Fantasy


## Author
[Bisyuu](https://github.com/Bisyuu)
